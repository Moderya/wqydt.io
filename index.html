<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>è¥¿å—æ—ä¸šå¤§å­¦æ™ºæ…§æ ¡å›­åœ°å›¾</title>
  
  <style>
    /* ===== åŸºç¡€å…¨å±€æ ·å¼é‡ç½® ===== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    html, body {
      width: 100%;
      height: 100%;
      font-family: "Microsoft YaHei", Arial, sans-serif;
      overflow: hidden;
    }
    
    /* åœ°å›¾æ ¸å¿ƒå®¹å™¨ */
    #container {
      width: 100%;
      height: 100%;
      position: relative;
    }
    
    /* ===== åŠ è½½åŠ¨ç”»é®ç½©å±‚æ ·å¼ ===== */
    .loading-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.95);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      transition: opacity 0.3s ease;
    }
    .spinner {
      width: 50px;
      height: 50px;
      border: 3px solid #f0f8f7;
      border-top: 3px solid #00796b;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* ===== å·¦ä¾§ä¾§è¾¹æ æ ·å¼ ===== */
    .sidebar {
      position: absolute;
      top: 20px;
      left: 20px;
      width: 300px;
      max-width: 90%;
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 6px 24px rgba(0, 0, 0, 0.12);
      z-index: 10;
      padding: 20px;
      max-height: 80vh;
      overflow-y: auto;
      border: 1px solid #f5f5f5;
    }
    .sidebar h3 {
      color: #00796b;
      margin-bottom: 15px;
      font-size: 18px;
      font-weight: 600;
    }
    .spot-item {
      padding: 12px 8px;
      border-bottom: 1px solid #f1f1f1;
      cursor: pointer;
      transition: all 0.2s ease;
      border-radius: 6px;
      margin-bottom: 4px;
    }
    .spot-item:hover {
      background-color: #f8fdfc;
      transform: translateX(2px);
    }
    .spot-item strong {
      color: #263238;
      font-size: 14px;
    }
    .spot-item p {
      font-size: 12px;
      color: #546e7a;
      margin: 4px 0 0 0;
      line-height: 1.4;
    }

    /* ===== è‡ªå®šä¹‰é«˜å¾·æ§ä»¶æ ·å¼ ===== */
    /* å·¥å…·æ¡æ ·å¼ */
    .amap-toolbar {
      border-radius: 8px !important;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
      border: none !important;
    }
    /* æ¯”ä¾‹å°ºæ ·å¼ */
    .amap-scale {
      border-radius: 6px 6px 0 0 !important;
      background: rgba(255, 255, 255, 0.9) !important;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
      border: none !important;
    }
    /* é¹°çœ¼æ ·å¼ */
    .amap-hawk-eye {
      border-radius: 8px !important;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
      border: none !important;
    }
    /* å›¾å±‚åˆ‡æ¢æ ·å¼ */
    .amap-maptype {
      border-radius: 8px !important;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
      border: none !important;
    }
    /* å®šä½æ§ä»¶æ ·å¼ */
    .amap-geolocation {
      border-radius: 8px !important;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
      border: none !important;
    }

    /* ===== å“åº”å¼è®¾è®¡ ===== */
    @media (max-width: 768px) {
      .sidebar {
        width: calc(100% - 40px);
        max-height: 200px;
      }
    }
    @media (max-width: 480px) {
      .sidebar {
        padding: 15px;
      }
      .sidebar h3 {
        font-size: 16px;
      }
      .spot-item strong {
        font-size: 13px;
      }
      .spot-item p {
        font-size: 11px;
      }
    }
  </style>
</head>

<body>
  <!-- åŠ è½½é®ç½© -->
  <div id="loading" class="loading-overlay">
    <div class="spinner"></div>
    <p>æ ¡å›­åœ°å›¾èµ„æºåŠ è½½ä¸­ï¼Œè¯·ç¨å€™...</p>
  </div>
  
  <!-- å·¦ä¾§ä¾§è¾¹æ  -->
  <div class="sidebar" id="sidebar">
    <h3>è¥¿å—æ—ä¸šå¤§å­¦æ™ºæ…§æ ¡å›­</h3>
    <p id="campus-intro"></p>
    <div id="spot-list" style="margin-top: 15px;"></div>
  </div>
  
  <!-- åœ°å›¾æ ¸å¿ƒå®¹å™¨ -->
  <div id="container"></div>

  <!-- é«˜å¾·åœ°å›¾å®‰å…¨é…ç½® -->
  <script type="text/javascript">
    window._AMapSecurityConfig = {
      securityJsCode: "50f177b3ea427e38fc9eaa98d293d074"
    };
  </script>
  
  <!-- é«˜å¾·åœ°å›¾APIåŠ è½½å™¨ -->
  <script src="https://webapi.amap.com/loader.js"></script>
  
  <!-- ä¸»åº”ç”¨è„šæœ¬ -->
  <script type="text/javascript">
    // ========= å…¨å±€é…ç½®å¸¸é‡ï¼ˆè°ƒæ•´æ ‡è®°ç‚¹åæ ‡+æ›¿æ¢æ–‡å­—è¡¨è¿°ï¼‰ =========
    const CONFIG = {
      amapKey: "3b181b254d0697c7ea2488fecc5abb2f",
      campus: {
        name: "è¥¿å—æ—ä¸šå¤§å­¦ï¼ˆæ ¡æœ¬éƒ¨ï¼‰",
        center: [102.757800, 25.058200], // è°ƒæ•´æ ¡å›­ä¸­å¿ƒç‚¹
        zoom: 17,
        intro: `è¥¿å—æ—ä¸šå¤§å­¦æ ¡æœ¬éƒ¨åè½äºäº‘å—çœæ˜†æ˜å¸‚ç›˜é¾™åŒºç™½é¾™å¯º300å·ï¼Œæ˜¯å­¦æ ¡å¼€å±•æ•™å­¦ç§‘ç ”å·¥ä½œçš„æ ¸å¿ƒåŒºåŸŸã€‚`,
        spots: [ // é‡æ–°è°ƒæ•´æ‰€æœ‰ç‚¹ä½åæ ‡+æ›¿æ¢æ–‡å­—è¡¨è¿°
          { 
            id: 2, 
            position: [102.754800, 25.059200], // è‡³çœŸæ¥¼ï¼šè¥¿åŒ—ä¾§
            name: "è‡³çœŸæ¥¼", 
            type: "academic", 
            desc: "ä½œä¸ºæ ¡å†…æ ¸å¿ƒæ•™å­¦å»ºç­‘ï¼Œä¸»è¦æ‰¿æ‹…æ–‡ç†ç±»åŸºç¡€è¯¾ç¨‹çš„æ•™å­¦å·¥ä½œ", 
            fullDesc: `ğŸ“Œ è‡³çœŸæ¥¼ã€åŸºç¡€å­¦ç§‘æ•™å­¦ä¸»æ¥¼ã€‘
è¯¥æ•™å­¦æ¥¼æ˜¯å­¦æ ¡æ–‡ç†åŸºç¡€è¯¾ç¨‹çš„ä¸»è¦æ•™å­¦åœºæ‰€ï¼Œé…å¤‡æ ‡å‡†åŒ–æ•™å®¤ä¸å¤šåª’ä½“æ•™å­¦è®¾å¤‡ï¼Œæ»¡è¶³å…¨æ ¡å…¬å…±åŸºç¡€è¯¾æ•™å­¦éœ€æ±‚ã€‚` 
          },
          { 
            id: 3, 
            position: [102.758200, 25.059800], // è‡³å–„æ¥¼ï¼šä¸œåŒ—ä¾§
            name: "è‡³å–„æ¥¼", 
            type: "academic", 
            desc: "èšç„¦æ—å­¦ã€å›­æ—ç­‰ä¼˜åŠ¿ä¸“ä¸šæ•™å­¦ï¼Œæ˜¯æ—ä¸šç‰¹è‰²å­¦ç§‘çš„æ ¸å¿ƒæ•™å­¦åœºåœ°", 
            fullDesc: `ğŸ“Œ è‡³å–„æ¥¼ã€æ—å­¦ä¸“ä¸šæ•™å­¦ä¸»æ¥¼ã€‘
ä½œä¸ºå­¦æ ¡æ—å­¦ç‰¹è‰²å­¦ç§‘çš„æ ¸å¿ƒæ•™å­¦æ¥¼ï¼Œä¸»è¦å¼€å±•æ—å­¦ã€å›­æ—ã€æ£®æ—ä¿æŠ¤ç­‰ä¸“ä¸šè¯¾ç¨‹æ•™å­¦ï¼Œé…å¥—ä¸“ä¸šå®éªŒå®è®­è®¾æ–½ã€‚` 
          },
          { 
            id: 4, 
            position: [102.759300, 25.057800], // è‡³ä¿¡æ¥¼ï¼šä¸œä¾§
            name: "è‡³ä¿¡æ¥¼", 
            type: "academic", 
            desc: "ä»¥ç»ç®¡ã€æ–‡æ³•ç±»è¯¾ç¨‹æ•™å­¦ä¸ºä¸»ï¼Œæ˜¯æ ¡å†…ç»¼åˆæ€§æ–‡ç§‘æ•™å­¦å»ºç­‘", 
            fullDesc: `ğŸ“Œ è‡³ä¿¡æ¥¼ã€ç»¼åˆæ–‡ç§‘æ•™å­¦ä¸»æ¥¼ã€‘
ä¸»è¦æ‰¿æ‹…ç»æµç®¡ç†ã€äººæ–‡ç¤¾ç§‘ç±»ä¸“ä¸šè¯¾ç¨‹æ•™å­¦ä»»åŠ¡ï¼Œæ¥¼å†…è®¾æœ‰å¤šåª’ä½“æ•™å®¤ã€å°å‹ç ”è®¨å®¤ç­‰æ•™å­¦ç©ºé—´ã€‚` 
          },
          { 
            id: 6, 
            position: [102.760200, 25.058800], // ä¸»å›¾ä¹¦é¦†ï¼šä¸œå—ä¾§
            name: "ä¸»å›¾ä¹¦é¦†", 
            type: "library", 
            desc: "é¦†è—å„ç±»æ–‡çŒ®èµ„æºè¶…ç™¾ä¸‡å†Œï¼Œæ˜¯å…¨æ ¡å¸ˆç”ŸæŸ¥é˜…èµ„æ–™ã€è‡ªä¸»å­¦ä¹ çš„æ ¸å¿ƒåœºæ‰€", 
            fullDesc: `ğŸ“Œ ä¸»å›¾ä¹¦é¦†ã€å…¨æ ¡æ ¸å¿ƒæ–‡çŒ®é¦†è—ä¸­å¿ƒã€‘
é¦†å†…æ”¶è—æ¶µç›–å„å­¦ç§‘é¢†åŸŸçš„å›¾ä¹¦ã€æœŸåˆŠã€ç”µå­èµ„æºç­‰ï¼Œè®¾æœ‰é˜…è§ˆåŒºã€è‡ªä¹ åŒºã€ç”µå­é˜…è§ˆå®¤ç­‰åŠŸèƒ½åŒºåŸŸï¼Œæ»¡è¶³å¸ˆç”Ÿå¤šæ ·åŒ–å­¦ä¹ éœ€æ±‚ã€‚` 
          },
          { 
            id: 7, 
            position: [102.758800, 25.058800], // æ—ä¸šä¸“ä¸šåˆ†é¦†ï¼šä¸­ä¸œä¾§
            name: "æ—ä¸šä¸“ä¸šåˆ†é¦†", 
            type: "library", 
            desc: "ä¸“æ³¨æ”¶è—æ—å­¦ç›¸å…³ä¸“ä¸šæ–‡çŒ®èµ„æ–™ï¼Œæ˜¯æ—ä¸šå­¦ç§‘çš„ç‰¹è‰²é¦†è—å›¾ä¹¦é¦†", 
            fullDesc: `ğŸ“Œ æ—ä¸šä¸“ä¸šåˆ†é¦†ã€æ—å­¦ç‰¹è‰²æ–‡çŒ®é¦†è—ä¸­å¿ƒã€‘
é‡ç‚¹æ”¶è—æ—å­¦ã€æ£®æ—å·¥ç¨‹ã€é£æ™¯å›­æ—ç­‰é¢†åŸŸçš„ä¸“ä¸šæ–‡çŒ®ï¼Œä¸ºæ—ä¸šå­¦ç§‘çš„æ•™å­¦ç§‘ç ”æä¾›ä¸“å±èµ„æºæ”¯æ’‘ã€‚` 
          },
          { 
            id: 8, 
            position: [102.755800, 25.056800], // å—è‹‘å­¦ç”Ÿé£Ÿå ‚ï¼šè¥¿å—ä¾§
            name: "å—è‹‘å­¦ç”Ÿé£Ÿå ‚", 
            type: "dining", 
            desc: "æ ¡å†…è§„æ¨¡è¾ƒå¤§çš„å­¦ç”Ÿé£Ÿå ‚ï¼Œèœå“ä¸°å¯Œå¤šæ ·ï¼Œå…¼é¡¾å£å‘³ä¸æ€§ä»·æ¯”", 
            fullDesc: `ğŸ“Œ å—è‹‘å­¦ç”Ÿé£Ÿå ‚ã€æ ¡å›­æ ¸å¿ƒé¤é¥®æœåŠ¡ä¸­å¿ƒã€‘
é£Ÿå ‚æä¾›æ—©ä¸­æ™šä¸‰é¤ï¼Œæ¶µç›–æ»‡å‘³ã€å·å‘³ã€å®¶å¸¸èœç­‰å¤šç§å£å‘³ï¼Œè®¾æœ‰å¤§ä¼—é¤åŒºã€ç‰¹è‰²çª—å£ï¼Œæ»¡è¶³å¸ˆç”Ÿæ—¥å¸¸ç”¨é¤éœ€æ±‚ã€‚` 
          },
          { 
            id: 9, 
            position: [102.759800, 25.056800], // åŒ—è‹‘é£Ÿå ‚ï¼šå—ä¾§
            name: "åŒ—è‹‘é£Ÿå ‚", 
            type: "dining", 
            desc: "ä»¥ç‰¹è‰²é£å‘³å°åƒä¸ºä¸»æ‰“ï¼Œæ˜¯æ ¡å†…æå…·ç‰¹è‰²çš„é¤é¥®æœåŠ¡åœºæ‰€", 
            fullDesc: `ğŸ“Œ åŒ—è‹‘é£Ÿå ‚ã€æ ¡å›­ç‰¹è‰²é£å‘³é¤é¥®ä¸­å¿ƒã€‘
ä¸»æ‰“å„ç±»åœ°æ–¹ç‰¹è‰²å°åƒã€å¿«é¤ç®€é¤ï¼Œèœå“æ›´æ–°å¿«ã€å£å‘³ç‹¬ç‰¹ï¼Œæ˜¯å­¦ç”Ÿæ—¥å¸¸å°±é¤çš„çƒ­é—¨é€‰æ‹©ã€‚` 
          },
          { 
            id: 12, 
            position: [102.757800, 25.057200], // ä½“è‚²é¦†ï¼šä¸­å—ä¾§
            name: "ä½“è‚²é¦†", 
            type: "sports", 
            desc: "é›†å¤šç§è¿åŠ¨åœºåœ°äºä¸€ä½“çš„ç»¼åˆæ€§ä½“è‚²åœºé¦†ï¼Œæ»¡è¶³å¸ˆç”Ÿä½“è‚²é”»ç‚¼éœ€æ±‚", 
            fullDesc: `ğŸ“Œ ä½“è‚²é¦†ã€æ ¡å›­ç»¼åˆä½“è‚²æ´»åŠ¨ä¸­å¿ƒã€‘
é¦†å†…è®¾æœ‰ç¯®çƒåœºã€ç¾½æ¯›çƒåœºã€å¥èº«æˆ¿ç­‰è¿åŠ¨åŒºåŸŸï¼Œå¯å¼€å±•å„ç±»ä½“è‚²æ•™å­¦ã€è®­ç»ƒåŠæ ¡å›­ä½“è‚²æ´»åŠ¨ã€‚` 
          }
        ]
      }
    };

    // ========= æ™ºæ…§æ ¡å›­åœ°å›¾ç±» =========
    class SmartCampusMap {
      constructor() {
        this.map = null;
        this.AMap = null;
        this.markers = [];
        this.infoWindows = [];
        this.normalIcon = null;
      }

      async init() {
        try {
          // åŠ è½½é«˜å¾·åœ°å›¾
          this.AMap = await AMapLoader.load({
            key: CONFIG.amapKey,
            version: "2.0",
            plugins: ['AMap.ToolBar', 'AMap.Scale', 'AMap.HawkEye', 'AMap.MapType','AMap.InfoWindow', 'AMap.Geolocation']
          });

          // åˆ›å»º2Dåœ°å›¾å®ä¾‹
          this.map = new this.AMap.Map("container", {
            viewMode: '2D',
            zoom: CONFIG.campus.zoom,
            center: CONFIG.campus.center,
            pitch: 0,
            rotation: 0,
            mapStyle: 'amap://styles/light',
            // éšè—é»˜è®¤å›¾å±‚åˆ‡æ¢æ§ä»¶ï¼ˆè‡ªå®šä¹‰ä½ç½®ï¼‰
            defaultLayer: false
          });

          // åˆå§‹åŒ–åŠŸèƒ½ï¼ˆåˆ é™¤æ ‡å‡†å›¾å±‚åŠ è½½ï¼‰
          this.initIcons();
          this.addControls(); // ä»…ä¿ç•™æ§ä»¶æ·»åŠ ï¼Œåˆ é™¤addLayersè°ƒç”¨
          this.addMarkers();
          this.updateSidebar();
          this.hideLoading();
          this.adjustView();
        } catch (error) {
          console.error('âŒ åœ°å›¾åˆå§‹åŒ–å¤±è´¥:', error);
          this.showError('åœ°å›¾åŠ è½½å¼‚å¸¸ï¼Œè¯·åˆ·æ–°é¡µé¢æˆ–æ£€æŸ¥ç½‘ç»œè¿æ¥');
        }
      }

      // åˆå§‹åŒ–ç‚¹ä½å›¾æ ‡
      initIcons() {
        this.normalIcon = new this.AMap.Icon({ 
          size: new this.AMap.Size(40, 48), 
          image: "https://webapi.amap.com/theme/v1.3/markers/n/mark_b.png", 
          imageSize: new this.AMap.Size(40, 48), 
          anchor: 'bottom-center' 
        });
      }

      // è°ƒæ•´æ§ä»¶ä½ç½®å’Œæ ·å¼
      addControls() {
        // å·¥å…·æ¡ï¼šå·¦ä¸‹è§’ï¼ˆLBï¼‰
        this.map.addControl(new this.AMap.ToolBar({ 
          position: 'LB',
          offset: [10, 80], // åç§»é‡ï¼Œé¿å…é®æŒ¡
          liteStyle: true // ç®€æ´æ ·å¼
        }));
        
        // æ¯”ä¾‹å°ºï¼šå³ä¸‹è§’ï¼ˆRBï¼‰
        this.map.addControl(new this.AMap.Scale({ 
          position: 'RB',
          offset: [10, 40]
        }));
        
        // é¹°çœ¼ï¼šå³ä¸Šè§’ï¼ˆRTï¼‰
        this.map.addControl(new this.AMap.HawkEye({ 
          isOpen: true, 
          position: 'RT',
          offset: [10, 10],
          size: [150, 120] // è°ƒæ•´å¤§å°
        }));
        
        // å›¾å±‚åˆ‡æ¢ï¼šå³ä¸‹è§’ï¼ˆRBï¼‰
        this.map.addControl(new this.AMap.MapType({ 
          defaultType: 0, 
          position: 'RB',
          offset: [10, 10],
          showTraffic: false, // éšè—äº¤é€šå›¾å±‚
          showSatellite: false // éšè—å«æ˜Ÿå›¾å±‚
        }));
        
        // å®šä½æ§ä»¶ï¼šå·¦ä¸Šè§’ï¼ˆLTï¼‰
        this.map.addControl(new this.AMap.Geolocation({ 
          position: 'LT',
          offset: [10, 80],
          showCircle: false,
          enableHighAccuracy: true,
          timeout: 10000
        }));
      }

      // æ¸²æŸ“ç‚¹ä½æ ‡è®°
      addMarkers() {
        const { spots } = CONFIG.campus;
        const _this = this;
        
        // æ·»åŠ æ ¡å›­ä¸­å¿ƒç‚¹æ ‡è®°
        const mainMarker = new this.AMap.Marker({ 
          position: CONFIG.campus.center, 
          icon: this.normalIcon, 
          anchor: 'bottom-center', 
          zIndex: 100 
        });
        const mainInfoWindow = new this.AMap.InfoWindow({ 
          content: this.getCampusInfoContent(), 
          offset: new this.AMap.Pixel(0, -100), 
          closeWhenClickMap: true,
          borderRadius: 12, // è‡ªå®šä¹‰å¼¹çª—åœ†è§’
          shadow: '0 4px 12px rgba(0,0,0,0.1)' // å¼¹çª—é˜´å½±
        });
        mainMarker.on('click', function() { 
          _this.closeAllInfoWindows(); 
          mainInfoWindow.open(_this.map, CONFIG.campus.center); 
          _this.infoWindows.push(mainInfoWindow); 
        });
        this.map.add(mainMarker);
        this.markers.push(mainMarker);

        // å¾ªç¯æ·»åŠ æ‰€æœ‰ç‚¹ä½æ ‡è®°
        spots.forEach(spot => {
          const marker = new this.AMap.Marker({ 
            position: spot.position, 
            icon: this.normalIcon, 
            anchor: 'bottom-center', 
            title: spot.name, 
            extData: spot,
            zIndex: 90 
          });
          const infoWindow = new this.AMap.InfoWindow({ 
            content: this.getSpotInfoContent(spot), 
            offset: new this.AMap.Pixel(0, -60), 
            closeWhenClickMap: true,
            borderRadius: 12,
            shadow: '0 4px 12px rgba(0,0,0,0.1)'
          });
          
          marker.on('click', function() {
            _this.closeAllInfoWindows();
            infoWindow.open(_this.map, spot.position);
            _this.infoWindows.push(infoWindow); 
            _this.map.setCenter(spot.position);
            _this.map.setZoom(18);
          });
          this.map.add(marker);
          this.markers.push(marker);
        });
      }

      // æ ¡å›­ä¸­å¿ƒç‚¹å¼¹çª—å†…å®¹ï¼ˆæ›¿æ¢æ–‡å­—è¡¨è¿°ï¼‰
      getCampusInfoContent() {
        return `<div style="width: 320px; padding: 18px; border-radius: 10px;">
          <h3 style="color: #00796b; margin: 0 0 12px 0; font-size: 16px; font-weight: 600;">${CONFIG.campus.name}</h3>
          <p style="margin: 0; color: #546e7a; line-height: 1.7; font-size: 14px; white-space: pre-line;">
            ${CONFIG.campus.intro}<br/><br/>
            ğŸ“ å…·ä½“åœ°å€ï¼šäº‘å—çœæ˜†æ˜å¸‚ç›˜é¾™åŒºç™½é¾™å¯º300å·<br/>
            ğŸš äº¤é€šæƒ…å†µï¼šæ ¡åŒºå‘¨è¾¹è®¾æœ‰å¤šä¸ªå…¬äº¤ç«™ç‚¹ï¼Œæ–¹ä¾¿å¸ˆç”Ÿæ—¥å¸¸å‡ºè¡Œ<br/>
            ğŸŒ¿ åŠå­¦ç‰¹è‰²ï¼šä»¥æ—å­¦ã€é£æ™¯å›­æ—ç­‰å­¦ç§‘ä¸ºä¼˜åŠ¿ï¼Œæ‹¥æœ‰å¤šä¸ªçœçº§æ—ä¸šç§‘ç ”å¹³å°ï¼Œæ˜¯è¥¿å—åœ°åŒºæ—ä¸šäººæ‰åŸ¹å…»çš„é‡è¦åŸºåœ°ã€‚
          </p>
        </div>`;
      }

      // ç‚¹ä½å¼¹çª—å†…å®¹
      getSpotInfoContent(spot) {
        return `<div style="width: 340px; padding: 18px; border-radius: 10px; background: #ffffff;">
          <h4 style="color: #00796b; margin: 0 0 12px 0; font-size: 16px; font-weight: 600;">${spot.name}</h4>
          <p style="margin: 0; color: #263238; line-height: 1.7; font-size: 14px; white-space: pre-line;">${spot.fullDesc}</p>
          <div style="margin-top:12px;font-size:12px;color:#888;text-align:right;">ç‚¹å‡»åœ°å›¾ç©ºç™½åŒºåŸŸå¯å…³é—­æ­¤çª—å£</div>
        </div>`;
      }

      // å…³é—­æ‰€æœ‰å¼¹çª—
      closeAllInfoWindows() {
        this.infoWindows.forEach(window => window.close());
        this.infoWindows = [];
      }

      // æ¸²æŸ“ä¾§è¾¹æ 
      updateSidebar() {
        document.getElementById('campus-intro').textContent = CONFIG.campus.intro.replace(/\n/g, ' ');
        document.getElementById('spot-list').innerHTML = CONFIG.campus.spots.map(spot => 
          `<div class="spot-item" onclick="campusMap.flyToSpot(${spot.id})">
            <strong>${spot.name}</strong>
            <p>${spot.desc.substring(0, 40)}...</p>
          </div>`
        ).join('');
      }

      // ä¾§è¾¹æ ç‚¹å‡»è·³è½¬ç‚¹ä½
      flyToSpot(spotId) {
        const spot = CONFIG.campus.spots.find(s => s.id === spotId);
        if(spot){
          this.map.setCenter(spot.position);
          this.map.setZoom(18);
          const marker = this.markers.find(m => m.getExtData()?.id === spotId);
          marker && marker.emit('click');
        }
      }

      // è‡ªé€‚åº”è§†é‡
      adjustView() {
        if(this.markers.length>0)
          this.map.setFitView(this.markers, false, [80,80,80,80]);
      }

      // éšè—åŠ è½½åŠ¨ç”»
      hideLoading() {
        const loadingEl = document.getElementById('loading');
        loadingEl.style.opacity = 0;
        setTimeout(() => {
          loadingEl.style.display = 'none';
        }, 300);
      }

      // åŠ è½½å¤±è´¥æç¤ºï¼ˆæ›¿æ¢æ–‡å­—ï¼‰
      showError(message) {
        document.getElementById('loading').innerHTML = `<div style="text-align:center;color:#e53935;">
          <div style="font-size:48px;margin-bottom:20px;">âš ï¸</div>
          <h3>åœ°å›¾åŠ è½½å¤±è´¥</h3>
          <p>${message}</p>
          <button onclick="location.reload()" style="margin-top:20px;padding:10px 20px;background:#00796b;color:white;border:none;border-radius:6px;cursor:pointer;transition:background 0.2s;">
            ç‚¹å‡»é‡æ–°åŠ è½½åœ°å›¾
          </button>
        </div>`;
      }
    }

    // åˆå§‹åŒ–åœ°å›¾
    let campusMap;
    document.addEventListener('DOMContentLoaded', () => {
      campusMap = new SmartCampusMap();
      campusMap.init();
      window.campusMap = campusMap;
    });

    // çª—å£ç¼©æ”¾é€‚é…
    window.addEventListener('resize', () => {
      if(campusMap && campusMap.map)
        campusMap.map.setFitView(campusMap.markers, false, [80,80,80,80]);
    });
  </script>
</body>
</html>
